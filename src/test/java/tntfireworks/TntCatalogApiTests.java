package tntfireworks;

import java.lang.reflect.Type;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;

import org.mockito.MockitoAnnotations;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.reflect.TypeToken;
import com.squareup.connect.v2.BatchUpsertCatalogObjectsRequest;
import com.squareup.connect.v2.Catalog;
import com.squareup.connect.v2.CatalogObject;
import com.squareup.connect.v2.SquareClientV2;

import junit.framework.TestCase;
import util.SquarePayload;

public class TntCatalogApiTests extends TestCase {

    private static final String apiUrl = "https://connect.squareupstaging.com";
    private static final String deploymentJson = "{\"merchantId\":\"3M4YT8JKYHAVJ\",\"accessToken\":\"sq0ats-RSCJWip1Slxf71xI4YKI1w\",\"merchantAlias\":\"Tnt Fireworks 1\",\"legacySingleLocationSquareAccount\":false}";
    private static final String locationMarketingPlanCacheJson = "{\"FAL0004\":\"2TNTC\",\"FAL0002\":\"2TNTC\",\"AZP0002\":\"2TNTC\",\"TX 0489\":\"6LAR\",\"AZP0001\":\"6LAR\"}";
    private static final String marketingPlanItemsCacheJson = "{\"2TNTC\":[{\"number\":\"100138\",\"category\":\"ASSORTMENTS\",\"description\":\"BURSTING W/PRIDE POLYBAG\",\"suggestedPrice\":\"29.99\",\"upc\":\"27736000289\",\"marketingPlan\":\"2TNTC\",\"currency\":\"USD\"},{\"number\":\"100382\",\"category\":\"ASSORTMENTS\",\"description\":\"TNT HOT SHOT BAG C\",\"suggestedPrice\":\"14.99\",\"upc\":\"27736000098\",\"marketingPlan\":\"2TNTC\",\"currency\":\"USD\"},{\"number\":\"100605\",\"category\":\"ASSORTMENTS\",\"description\":\"RED DEVIL TRAY SS\",\"suggestedPrice\":\"39.99\",\"upc\":\"27736031030\",\"marketingPlan\":\"2TNTC\",\"currency\":\"USD\"},{\"number\":\"100687\",\"category\":\"ASSORTMENTS\",\"description\":\"SUPER TNT TRAY C     4/1\",\"suggestedPrice\":\"79.99\",\"upc\":\"27736003037\",\"marketingPlan\":\"2TNTC\",\"currency\":\"USD\"},{\"number\":\"100690\",\"category\":\"ASSORTMENTS\",\"description\":\"SUPER TNT SS\",\"suggestedPrice\":\"39.99\",\"upc\":\"27736031054\",\"marketingPlan\":\"2TNTC\",\"currency\":\"USD\"},{\"number\":\"100934\",\"category\":\"ASSORTMENTS\",\"description\":\"GOODY BAG SS  PDQ\",\"suggestedPrice\":\"9.99\",\"upc\":\"27736012510\",\"marketingPlan\":\"2TNTC\",\"currency\":\"USD\"}],\"6LAR\":[{\"number\":\"100068\",\"category\":\"ASSORTMENTS\",\"description\":\"BATTLE CRY ASSORTMENT C\",\"suggestedPrice\":\"19.99\",\"upc\":\"27736000036\",\"marketingPlan\":\"6LAR\",\"currency\":\"USD\"},{\"number\":\"100075\",\"category\":\"ASSORTMENTS\",\"description\":\"BIG BOMB TRAY SS\",\"suggestedPrice\":\"39.99\",\"upc\":\"27736024421\",\"marketingPlan\":\"6LAR\",\"currency\":\"USD\"},{\"number\":\"100603\",\"category\":\"ASSORTMENTS\",\"description\":\"RED DEVIL TRAY C\",\"suggestedPrice\":\"39.99\",\"upc\":\"27736010509\",\"marketingPlan\":\"6LAR\",\"currency\":\"USD\"},{\"number\":\"100687\",\"category\":\"ASSORTMENTS\",\"description\":\"SUPER TNT TRAY C     4/1\",\"suggestedPrice\":\"39.99\",\"upc\":\"27736003037\",\"marketingPlan\":\"6LAR\",\"currency\":\"USD\"},{\"number\":\"100731\",\"category\":\"ASSORTMENTS\",\"description\":\"BLAST C\",\"suggestedPrice\":\"69.99\",\"upc\":\"27736006557\",\"marketingPlan\":\"6LAR\",\"currency\":\"USD\"},{\"number\":\"100934\",\"category\":\"ASSORTMENTS\",\"description\":\"GOODY BAG SS  PDQ\",\"suggestedPrice\":\"6.99\",\"upc\":\"27736012510\",\"marketingPlan\":\"6LAR\",\"currency\":\"USD\"}]}";
    private static final String locationsJson = "[{\"id\":\"7Y9J7C251APH3\",\"name\":\"6924 HWY 359 (#TX 0489)\",\"address\":{\"address_line_1\":\"450 14th St\",\"address_line_2\":\"\",\"locality\":\"San Francisco\",\"administrative_district_level_1\":\"CA\",\"postal_code\":\"94103-2316\",\"country\":\"US\"},\"timezone\":\"America/Los_Angeles\",\"capabilities\":[\"CREDIT_CARD_PROCESSING\"]},{\"id\":\"F8M9VD8NNBQ7J\",\"name\":\"VACANT LOT (#FAL0004)\",\"address\":{\"address_line_1\":\"450 14th St\",\"address_line_2\":\"\",\"locality\":\"San Francisco\",\"administrative_district_level_1\":\"CA\",\"postal_code\":\"94103-2316\",\"country\":\"US\"},\"timezone\":\"America/Los_Angeles\",\"capabilities\":[\"CREDIT_CARD_PROCESSING\"]},{\"id\":\"2QD45WEE8B1BW\",\"name\":\"WHEELER ALEX CITY MARKETPLACE (#FAL0002)\",\"address\":{\"address_line_1\":\"450 14th St\",\"address_line_2\":\"\",\"locality\":\"San Francisco\",\"administrative_district_level_1\":\"CA\",\"postal_code\":\"94103-2316\",\"country\":\"US\"},\"timezone\":\"America/Los_Angeles\",\"capabilities\":[\"CREDIT_CARD_PROCESSING\"]}]";
    private static final String emptyCatalog = "{\"items\":{},\"categories\":{},\"taxes\":{},\"discounts\":{},\"modifierLists\":{},\"itemsPrimaryKey\":\"SKU\",\"categoriesPrimaryKey\":\"NAME\",\"taxesPrimaryKey\":\"ID\",\"discountsPrimaryKey\":\"NAME\",\"modifierListsPrimaryKey\":\"NAME\"}";
    private static final String catalogWithCategoriesOnly = "{\"items\":{},\"categories\":{\"SPARKLERS\":{\"type\":\"CATEGORY\",\"id\":\"2B5TOMTLP2HOLAJBFBDNVQTB\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"SPARKLERS\"}},\"ASSORTMENTS\":{\"type\":\"CATEGORY\",\"id\":\"EW7GUKQVYMF3XW3TQ3ECH67G\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"ASSORTMENTS\"}},\"CALIFORNIA FOUNTAINS\":{\"type\":\"CATEGORY\",\"id\":\"DEJNKSKJSQ7SD6NESC72L4D5\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"CALIFORNIA FOUNTAINS\"}},\"PUNK\":{\"type\":\"CATEGORY\",\"id\":\"AC75SSL5IUVKCYKH4Q2OU56B\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"PUNK\"}},\"CONE FOUNTAINS\":{\"type\":\"CATEGORY\",\"id\":\"H5ENCP54PVOLO4PNLPCRCLLN\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"CONE FOUNTAINS\"}},\"BASE FOUNTAINS\":{\"type\":\"CATEGORY\",\"id\":\"2XTFB7N35HCZVJERSVHFASP4\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"BASE FOUNTAINS\"}},\"SPECIAL AERIALS\":{\"type\":\"CATEGORY\",\"id\":\"KZOMJ4UP3PYATXFLJFP5OVZV\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"SPECIAL AERIALS\"}},\"FIRECRACKERS\":{\"type\":\"CATEGORY\",\"id\":\"PUBMBXXMZAJ5MZCMVTHWZZZX\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"FIRECRACKERS\"}},\"RELOADABLES\":{\"type\":\"CATEGORY\",\"id\":\"UVSK4EZMIB4AH4GDYWBO7OXL\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"RELOADABLES\"}},\"MULTI-AERIALS\":{\"type\":\"CATEGORY\",\"id\":\"XVT22UFHORLOCGH6PT7OODLE\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"MULTI-AERIALS\"}},\"PROMOTIONAL\":{\"type\":\"CATEGORY\",\"id\":\"X44J3YR2XAAGUQLDJFRBC63E\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"PROMOTIONAL\"}},\"PARACHUTES\":{\"type\":\"CATEGORY\",\"id\":\"GPPLLGSVTEK6VIXFKCDDKGBM\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"PARACHUTES\"}},\"GROUND SPINNERS \\u0026 CHASERS\":{\"type\":\"CATEGORY\",\"id\":\"36KLM2KR65K3RY65HDQUYNUL\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"GROUND SPINNERS \\u0026 CHASERS\"}},\"TOYS\":{\"type\":\"CATEGORY\",\"id\":\"J7ELXVKSBGPNBOZ7FYLTOG67\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"TOYS\"}},\"ROMAN CANDLES\":{\"type\":\"CATEGORY\",\"id\":\"TW4FMTLXV7F3YVZRJEWZGY2X\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"ROMAN CANDLES\"}},\"COUNTER CASES \\u0026 DISPLAYS\":{\"type\":\"CATEGORY\",\"id\":\"FLSU4A6WATYWJFCNQMJ5KJY4\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"COUNTER CASES \\u0026 DISPLAYS\"}},\"SMOKE\":{\"type\":\"CATEGORY\",\"id\":\"L544LZZXX7KXCWSB5UYG7CL4\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"SMOKE\"}},\"MISSILES\":{\"type\":\"CATEGORY\",\"id\":\"2M2UEFMGZ3EVMQVS5O7GIBZZ\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"MISSILES\"}},\"SUB ASSESMBLIES\":{\"type\":\"CATEGORY\",\"id\":\"2DFIMPGXLOWMDRLLIXDZUJI7\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"SUB ASSESMBLIES\"}},\"NOVELTIES\":{\"type\":\"CATEGORY\",\"id\":\"XMQTLRGY5VY2YWZUDC4365XU\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"NOVELTIES\"}},\"MATERIALS\":{\"type\":\"CATEGORY\",\"id\":\"IQRGSG4KVQZCIWKKL7TB2C3Y\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"MATERIALS\"}},\"ROCKETS\":{\"type\":\"CATEGORY\",\"id\":\"OIUAKQBZLVBE2PAJZ3IE4BVF\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"ROCKETS\"}},\"HELICOPTERS\":{\"type\":\"CATEGORY\",\"id\":\"O3QQYAH52FO7YYANOK73AVYZ\",\"updated_at\":\"2017-03-02T01:29:43.809Z\",\"version\":1488418183809,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"HELICOPTERS\"}}},\"taxes\":{},\"discounts\":{},\"modifierLists\":{},\"itemsPrimaryKey\":\"SKU\",\"categoriesPrimaryKey\":\"NAME\",\"taxesPrimaryKey\":\"ID\",\"discountsPrimaryKey\":\"NAME\",\"modifierListsPrimaryKey\":\"NAME\"}";
    private static final String firstInsertItemsRequest = "{\"idempotency_key\":\"18916670-9d8f-45f8-b657-52006d4ec62d\",\"batches\":[{\"objects\":[{\"type\":\"ITEM\",\"id\":\"#6074d74d-8efc-42ce-a5c8-b9b6abdf9f01\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\"],\"item_data\":{\"name\":\"RED DEVIL TRAY C\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#340528dc-e699-4023-b702-1b4750523f69\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\"],\"item_variation_data\":{\"item_id\":\"#6074d74d-8efc-42ce-a5c8-b9b6abdf9f01\",\"name\":\"100603\",\"sku\":\"27736010509\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"7Y9J7C251APH3\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#39749149-86d4-42e7-a284-06dfaab7a2fe\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\",\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_data\":{\"name\":\"SUPER TNT TRAY C     4/1\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#02dada43-c93c-402d-ac95-3b2c3aa289a3\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\",\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_variation_data\":{\"item_id\":\"#39749149-86d4-42e7-a284-06dfaab7a2fe\",\"name\":\"100687\",\"sku\":\"27736003037\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"7Y9J7C251APH3\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"},{\"location_id\":\"2QD45WEE8B1BW\",\"price_money\":{\"amount\":7999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"},{\"location_id\":\"F8M9VD8NNBQ7J\",\"price_money\":{\"amount\":7999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#b069846b-13ba-4e5b-83ea-6f78565c6f88\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_data\":{\"name\":\"TNT HOT SHOT BAG C\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#ffca0b1f-e80f-4eb1-9d07-c1209c1fadd6\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_variation_data\":{\"item_id\":\"#b069846b-13ba-4e5b-83ea-6f78565c6f88\",\"name\":\"100382\",\"sku\":\"27736000098\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":1499,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"2QD45WEE8B1BW\",\"price_money\":{\"amount\":1499,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"},{\"location_id\":\"F8M9VD8NNBQ7J\",\"price_money\":{\"amount\":1499,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#0dbb8026-1f06-4dd9-bbe8-995e3677e6b5\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\"],\"item_data\":{\"name\":\"BIG BOMB TRAY SS\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#51043678-83bb-4da1-864a-7363a13527bf\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\"],\"item_variation_data\":{\"item_id\":\"#0dbb8026-1f06-4dd9-bbe8-995e3677e6b5\",\"name\":\"100075\",\"sku\":\"27736024421\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"7Y9J7C251APH3\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#ddc8e02d-c1e2-45be-97cc-ee55a897c42e\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_data\":{\"name\":\"RED DEVIL TRAY SS\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#b423976e-96d9-47cc-a2e4-86a84dd8699b\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_variation_data\":{\"item_id\":\"#ddc8e02d-c1e2-45be-97cc-ee55a897c42e\",\"name\":\"100605\",\"sku\":\"27736031030\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"2QD45WEE8B1BW\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"},{\"location_id\":\"F8M9VD8NNBQ7J\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#9c36058c-8093-49fa-a541-2a350022c428\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_data\":{\"name\":\"SUPER TNT SS\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#ee127d3f-b76d-4bff-83e2-e3030ce17643\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_variation_data\":{\"item_id\":\"#9c36058c-8093-49fa-a541-2a350022c428\",\"name\":\"100690\",\"sku\":\"27736031054\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"2QD45WEE8B1BW\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"},{\"location_id\":\"F8M9VD8NNBQ7J\",\"price_money\":{\"amount\":3999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#8b394935-62f8-43e7-abb1-afb1aa20939d\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\",\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_data\":{\"name\":\"GOODY BAG SS  PDQ\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#51119896-2897-4ba7-93b2-ba60615b7a9e\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\",\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_variation_data\":{\"item_id\":\"#8b394935-62f8-43e7-abb1-afb1aa20939d\",\"name\":\"100934\",\"sku\":\"27736012510\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":699,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"7Y9J7C251APH3\",\"price_money\":{\"amount\":699,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"},{\"location_id\":\"2QD45WEE8B1BW\",\"price_money\":{\"amount\":999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"},{\"location_id\":\"F8M9VD8NNBQ7J\",\"price_money\":{\"amount\":999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#cee16512-681b-4fc7-96b2-9dc1271afc94\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_data\":{\"name\":\"BURSTING W/PRIDE POLYBAG\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#d8acf173-75b7-4b03-9d27-98b6ec8ecb48\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"2QD45WEE8B1BW\",\"F8M9VD8NNBQ7J\"],\"item_variation_data\":{\"item_id\":\"#cee16512-681b-4fc7-96b2-9dc1271afc94\",\"name\":\"100138\",\"sku\":\"27736000289\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":2999,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"2QD45WEE8B1BW\",\"price_money\":{\"amount\":2999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"},{\"location_id\":\"F8M9VD8NNBQ7J\",\"price_money\":{\"amount\":2999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#6b0c7065-0ef6-48a5-a4bf-d20a6143df86\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\"],\"item_data\":{\"name\":\"BATTLE CRY ASSORTMENT C\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#7c3a9fa5-d812-48eb-a1ac-f6be40176ebf\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\"],\"item_variation_data\":{\"item_id\":\"#6b0c7065-0ef6-48a5-a4bf-d20a6143df86\",\"name\":\"100068\",\"sku\":\"27736000036\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":1999,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"7Y9J7C251APH3\",\"price_money\":{\"amount\":1999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"ITEM\",\"id\":\"#a003fa63-3669-4e27-a688-69767ee5756d\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\"],\"item_data\":{\"name\":\"BLAST C\",\"available_online\":false,\"available_for_pickup\":false,\"available_electronically\":false,\"category_id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"variations\":[{\"type\":\"ITEM_VARIATION\",\"id\":\"#7441e6f2-487e-4b2d-bada-25e20a6038f9\",\"is_deleted\":false,\"present_at_all_locations\":false,\"present_at_location_ids\":[\"7Y9J7C251APH3\"],\"item_variation_data\":{\"item_id\":\"#a003fa63-3669-4e27-a688-69767ee5756d\",\"name\":\"100731\",\"sku\":\"27736006557\",\"ordinal\":0,\"pricing_type\":\"FIXED_PRICING\",\"price_money\":{\"amount\":6999,\"currency\":\"USD\"},\"location_overrides\":[{\"location_id\":\"7Y9J7C251APH3\",\"price_money\":{\"amount\":6999,\"currency\":\"USD\"},\"pricing_type\":\"FIXED_PRICING\"}],\"track_inventory\":false,\"inventory_alert_type\":\"NONE\",\"inventory_alert_threshold\":0}}]}},{\"type\":\"CATEGORY\",\"id\":\"L3O5RO4GOJ3UPXVGNCE5ANQY\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"SPARKLERS\"}},{\"type\":\"CATEGORY\",\"id\":\"2K5IJUAKQDVVY6IPCEMXJNAZ\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"ASSORTMENTS\"}},{\"type\":\"CATEGORY\",\"id\":\"ADNMI24HR357FDALLPPJVTBT\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"CALIFORNIA FOUNTAINS\"}},{\"type\":\"CATEGORY\",\"id\":\"TREGMMQ4JUZCIT3IEY3GUK54\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"PUNK\"}},{\"type\":\"CATEGORY\",\"id\":\"7LPYELLLM3QIIDUQRKVCKF7A\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"CONE FOUNTAINS\"}},{\"type\":\"CATEGORY\",\"id\":\"DIJY3WCUOK5HVPZKQ5NTWUSQ\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"BASE FOUNTAINS\"}},{\"type\":\"CATEGORY\",\"id\":\"BZEQMFPFUSXLDGSSGWAEJU2F\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"SPECIAL AERIALS\"}},{\"type\":\"CATEGORY\",\"id\":\"2HB5GOBIVVPPZV6TQNX4JR44\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"FIRECRACKERS\"}},{\"type\":\"CATEGORY\",\"id\":\"5YVKANRAL5N7M5DGVNQW3F6F\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"RELOADABLES\"}},{\"type\":\"CATEGORY\",\"id\":\"K4D6FVOGYTNYMRRWB7BVCTOQ\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"MULTI-AERIALS\"}},{\"type\":\"CATEGORY\",\"id\":\"66RMY7SOY676M22EB4TVY6LW\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"PROMOTIONAL\"}},{\"type\":\"CATEGORY\",\"id\":\"3UIXKS5K7BBWSTG4LP5763F5\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"PARACHUTES\"}},{\"type\":\"CATEGORY\",\"id\":\"IDVL6CJUI3GV6BL6J365F5NH\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"GROUND SPINNERS \\u0026 CHASERS\"}},{\"type\":\"CATEGORY\",\"id\":\"EZBD4SEKDUANDPQIKTKEZLKQ\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"TOYS\"}},{\"type\":\"CATEGORY\",\"id\":\"EVUXGAVJIFIWARZNZQKG77WQ\",\"updated_at\":\"2017-03-02T02:05:08.318Z\",\"version\":1488420308318,\"is_deleted\":false,\"present_at_all_locations\":true,\"category_data\":{\"name\":\"ROMAN CANDLES\"}}]}]}";
    private static final Type hashmapStringString = new TypeToken<HashMap<String, String>>() {
    }.getType();
    private static final Type hashmapStringListCsvItem = new TypeToken<HashMap<String, List<CsvItem>>>() {
    }.getType();
    private static final String ITEM = null;

    @Override
    protected void setUp() {
        MockitoAnnotations.initMocks(this);
    }

    public void testTntCatalogApiConstructor() throws Exception {

        //        GsonBuilder builder = new GsonBuilder();
        //        Gson gson = builder.create();
        //
        //        SquarePayload deployment = gson.fromJson(deploymentJson, SquarePayload.class);
        //        HashMap<String, String> locationMarketingPlanCache = gson.fromJson(locationMarketingPlanCacheJson,
        //                hashmapStringString);
        //        HashMap<String, List<CsvItem>> marketingPlanItemsCache = gson.fromJson(marketingPlanItemsCacheJson,
        //                hashmapStringListCsvItem);
        //        Location[] locationResults = gson.fromJson(locationsJson, Location[].class);
        //
        //        //SquareClientV2 client = new SquareClientV2(apiUrl, deployment.getAccessToken());
        //
        //        SquareClientV2 client = Mockito.mock(SquareClientV2.class);
        //        LocationsAdapter locationsAdapter = Mockito.mock(LocationsAdapter.class);
        //        CatalogAdapter catalogAdapter = Mockito.mock(CatalogAdapter.class);
        //
        //        Mockito.when(locationsAdapter.list()).thenReturn(locationResults);
        //        Mockito.when(client.locations()).thenReturn(locationsAdapter);
        //        Mockito.when(client.catalog()).thenReturn(catalogAdapter);
        //
        //        TntCatalogApi tntCatalogApi = new TntCatalogApi(client, locationMarketingPlanCache, marketingPlanItemsCache);
        //
        //        Mockito.verify(locationsAdapter).list();
        //        Mockito.verify(client).locations();
        //
        //        HashMap<String, List<String>> marketingPlanLocationsCache = Mockito
        //                .spy(tntCatalogApi.marketingPlanLocationsCache);
        //
        //        Assert.assertTrue(marketingPlanLocationsCache.containsKey("2TNTC"));
        //        Assert.assertTrue(marketingPlanLocationsCache.containsKey("6LAR"));
        //        Assert.assertTrue(marketingPlanLocationsCache.size() == 2);
        //
        //        String[] squareLocations = new String[] { "F8M9VD8NNBQ7J", "2QD45WEE8B1BW" };
        //        ArrayList<String> squareLocationsArray = new ArrayList<String>(Arrays.asList(squareLocations));
        //
        //        Assert.assertTrue(marketingPlanLocationsCache.get("2TNTC").containsAll(squareLocationsArray));
        //        Assert.assertTrue(marketingPlanLocationsCache.get("2TNTC").size() == 2);
        //        Assert.assertTrue(marketingPlanLocationsCache.get("6LAR").size() == 1);
        //        Assert.assertTrue(marketingPlanLocationsCache.get("6LAR").contains("7Y9J7C251APH3"));
        //
        //        Mockito.verify(client).catalog();

    }

    public void testCategories() {
        //TODO: Wtsang - write this test
    }

    public void testAddItemsAndVariations() {

        GsonBuilder builder = new GsonBuilder();
        Gson gson = builder.create();
        SquarePayload deployment = gson.fromJson(deploymentJson, SquarePayload.class);
        SquareClientV2 client = new SquareClientV2(apiUrl, deployment.getAccessToken());
        HashMap<String, String> locationMarketingPlanCache = gson.fromJson(locationMarketingPlanCacheJson,
                hashmapStringString);
        HashMap<String, List<CsvItem>> marketingPlanItemsCache = gson.fromJson(marketingPlanItemsCacheJson,
                hashmapStringListCsvItem);
        TntCatalogApi tntCatalogApi = new TntCatalogApi(client, locationMarketingPlanCache, marketingPlanItemsCache);

        BatchUpsertCatalogObjectsRequest upsertRequest = gson.fromJson(firstInsertItemsRequest,
                BatchUpsertCatalogObjectsRequest.class);

        ArrayList<CatalogObject> objectsToInsert = (ArrayList<CatalogObject>) Arrays
                .asList(upsertRequest.getBatches()[0].getObjects());

        //        tntCatalogApi.clearCatalog();
        //        tntCatalogApi.batchUpsertCategoriesFromDatabaseToSquare();
        //        tntCatalogApi.batchUpsertItemsIntoCatalog();

        System.out.println(gson.toJson(tntCatalogApi.retrieveCatalogFromSquare()));

    }

    private void generateCatalogWithOnlyCategories() {
        GsonBuilder builder = new GsonBuilder();
        Gson gson = builder.create();
        SquarePayload deployment = gson.fromJson(deploymentJson, SquarePayload.class);
        SquareClientV2 client = new SquareClientV2(apiUrl, deployment.getAccessToken());
        HashMap<String, String> locationMarketingPlanCache = gson.fromJson(locationMarketingPlanCacheJson,
                hashmapStringString);
        HashMap<String, List<CsvItem>> marketingPlanItemsCache = gson.fromJson(marketingPlanItemsCacheJson,
                hashmapStringListCsvItem);
        TntCatalogApi tntCatalogApi = new TntCatalogApi(client, locationMarketingPlanCache, marketingPlanItemsCache);
        Catalog catalog = tntCatalogApi.clearCatalog();
        catalog = tntCatalogApi.batchUpsertCategoriesFromDatabaseToSquare();
        catalog = tntCatalogApi.retrieveCatalogFromSquare();
        System.out.println(gson.toJson(catalog));
    }

}
